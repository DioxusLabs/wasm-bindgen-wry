function sync_request(endpoint,contents){let xhr=new XMLHttpRequest;xhr.open("POST",endpoint,!1),xhr.setRequestHeader("Content-Type","application/json");let json_string=JSON.stringify(contents);console.log("Sending request to Rust:",json_string);let contents_bytes=new TextEncoder().encode(json_string),contents_base64=btoa(String.fromCharCode.apply(null,contents_bytes));xhr.setRequestHeader("dioxus-data",contents_base64),xhr.send();let response_text=xhr.responseText;console.log("Received response from Rust:",response_text);try{return JSON.parse(response_text)}catch(e){return console.error("Failed to parse response JSON:",e),null}}function run_code(code,args){let f;switch(code){case 0:f=console.log;break;case 1:f=alert;break;case 2:f=function(a,b){return a+b};break;case 3:f=function(event_name,callback){document.addEventListener(event_name,function(e){if(callback.call())e.preventDefault(),console.log("Event "+event_name+" default prevented by Rust callback.")})};break;case 4:f=function(element_id,text_content){let element=document.getElementById(element_id);if(element)element.textContent=text_content;else console.warn("Element with ID "+element_id+" not found.")};break;default:throw new Error("Unknown code: "+code)}return f.apply(null,args)}function evaluate_from_rust(code,args_json){let args=deserialize_args(args_json),response={Respond:{response:run_code(code,args)||null}},request_result=sync_request("wry://handler",response);return handleResponse(request_result)}function deserialize_args(args_json){if(typeof args_json==="string")return args_json;else if(typeof args_json==="number")return args_json;else if(Array.isArray(args_json))return args_json.map(deserialize_args);else if(typeof args_json==="object"&&args_json!==null)if(args_json.type==="function")return new RustFunction(args_json.id);else{let obj={};for(let key in args_json)obj[key]=deserialize_args(args_json[key]);return obj}}function handleResponse(response){if(!response)return;if(console.log("Handling response:",response),response.Respond)return response.Respond.response;else if(response.Evaluate)return evaluate_from_rust(response.Evaluate.fn_id,response.Evaluate.args);else throw new Error("Unknown response type")}class RustFunction{code;constructor(code){this.code=code}call(...args){let response=sync_request("wry://handler",{Evaluate:{fn_id:this.code,args}});return handleResponse(response)}}window.evaluate_from_rust=evaluate_from_rust;
